<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Local on 50th - Tip Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        input[type="number"],
        input[type="text"],
        input[type="password"],
        input[type="date"],
        select {
            font-size: 16px !important;
        }
        
        button {
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (max-width: 768px) {
            input, button, select {
                min-height: 44px;
            }
            
            .grid {
                gap: 1rem !important;
            }
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen p-2 sm:p-4">
    <div id="login-screen" class="max-w-md mx-auto mt-10 sm:mt-20 px-4">
        <div class="bg-white rounded-lg shadow-lg p-6 sm:p-8">
            <div class="text-center mb-6 sm:mb-8">
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">The Local on 50th</h1>
                <p class="text-sm sm:text-base text-slate-600">Daily Tip Calculator</p>
            </div>
            <div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Enter Password</label>
                    <input type="password" id="password-input" placeholder="Password"
                        class="w-full px-4 py-3 border border-slate-300 rounded-lg text-base" autofocus 
                        onkeypress="if(event.key==='Enter') checkPassword()" />
                    <p id="error-message" class="text-red-600 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
                </div>
                <button onclick="checkPassword()" class="w-full bg-slate-800 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg hover:bg-slate-700 active:bg-slate-900">
                    Access Calculator
                </button>
            </div>
        </div>
    </div>

    <div id="main-app" style="display:none;" class="max-w-4xl mx-auto px-2 sm:px-4">
        <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 sm:mb-6 gap-3">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-800">The Local on 50th</h1>
                    <p class="text-sm sm:text-base text-slate-600">Daily Tip Calculator & Report</p>
                </div>
                <div class="w-full sm:w-auto flex gap-2 items-center">
                    <input type="date" id="date-input" class="flex-1 sm:w-auto px-3 sm:px-4 py-2 border border-slate-300 rounded-lg text-base sm:text-lg font-semibold" />
                    <button onclick="loadEmployeesFromSheet()" class="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200" title="Refresh employee list">
                        üîÑ
                    </button>
                </div>
            </div>
            
            <div id="load-status" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

            <div class="bg-slate-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                <h2 class="text-lg sm:text-xl font-semibold text-slate-800 mb-3 sm:mb-4">üíµ Sales & Tips</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Total Sales</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 sm:top-2 text-slate-600 text-base sm:text-lg">$</span>
                            <input type="number" step="0.01" id="total-sales" placeholder="0.00"
                                class="w-full pl-8 pr-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Cash Sales</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 sm:top-2 text-slate-600 text-base sm:text-lg">$</span>
                            <input type="number" step="0.01" id="cash-sales" placeholder="0.00"
                                class="w-full pl-8 pr-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Credit Card Tips</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 sm:top-2 text-slate-600 text-base sm:text-lg">$</span>
                            <input type="number" step="0.01" id="cc-tips" placeholder="0.00"
                                class="w-full pl-8 pr-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Cash Tips</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 sm:top-2 text-slate-600 text-base sm:text-lg">$</span>
                            <input type="number" step="0.01" id="cash-tips" placeholder="0.00"
                                class="w-full pl-8 pr-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Total Host Tips</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 sm:top-2 text-slate-600 text-base sm:text-lg">$</span>
                            <input type="number" step="0.01" id="host-tips" placeholder="0.00"
                                class="w-full pl-8 pr-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-purple-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4 gap-2">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-800">üë• Hosts (Keep 100% - Split Evenly)</h2>
                    <button onclick="addEmployee('hosts')" class="w-full sm:w-auto px-3 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 active:bg-purple-800">
                        + Add Host
                    </button>
                </div>
                <div id="hosts-list"></div>
            </div>

            <div class="bg-blue-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4 gap-2">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-800">üë• Bussers/Expo (2% of Sales)</h2>
                    <button onclick="addEmployee('bussers')" class="w-full sm:w-auto px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 active:bg-blue-800">
                        + Add Busser/Expo
                    </button>
                </div>
                <div id="bussers-list"></div>
            </div>

            <div class="bg-orange-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4 gap-2">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-800">üë• BOH / Kitchen (1% - Split Evenly)</h2>
                    <button onclick="addEmployee('kitchen')" class="w-full sm:w-auto px-3 py-2 bg-orange-600 text-white rounded-lg text-sm hover:bg-orange-700 active:bg-orange-800">
                        + Add Kitchen
                    </button>
                </div>
                <div id="kitchen-list"></div>
            </div>

            <div class="bg-green-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4 gap-2">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-800">üë• Servers/Bartenders (FOH Pool)</h2>
                    <button onclick="addEmployee('servers')" class="w-full sm:w-auto px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 active:bg-green-800">
                        + Add Server/Bartender
                    </button>
                </div>
                <div id="servers-list"></div>
            </div>

            <button onclick="calculateTips()" class="w-full bg-slate-800 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg hover:bg-slate-700 active:bg-slate-900">
                üßÆ Calculate Tips
            </button>
        </div>

        <div id="results" style="display:none;" class="bg-white rounded-lg shadow-lg p-4 sm:p-6"></div>
    </div>

    <script>
        const CORRECT_PASSWORD = 'thelocal';
        
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSmYcpBNfkCmmSAIEs-3D17mGkSkINHeElu-86aW3DrzLDZQEREm0mlv_SiPzOmvCtLSYVGOOWf_ynM/pub?output=csv';
        const SHEET_CSV_URL = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(GOOGLE_SHEET_URL) + '&_=' + Date.now();
        
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwypwQv6l5uDtP30nRnaeQffPrkswoNgLRvzQOIQuAwC0TQmBuWghAFFSHkGKhs_lc/exec';
        
        let EMPLOYEE_LIST = { servers: [], bussers: [], hosts: [], kitchen: [] };
        let calculatedResults = null;
        let dailyTotals = null;
        let employees = {
            hosts: [{ name: '' }],
            bussers: [{ name: '', hours: '' }],
            kitchen: [{ name: '' }],
            servers: [{ name: '', hours: '' }]
        };

        function checkPassword() {
            const input = document.getElementById('password-input');
            const error = document.getElementById('error-message');
            if (input.value === CORRECT_PASSWORD) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                initializeApp();
            } else {
                error.style.display = 'block';
                input.classList.add('border-red-500', 'bg-red-50');
                input.value = '';
                input.focus();
            }
        }

        function initializeApp() {
const now = new Date();
const pstString = now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles', year: 'numeric', month: '2-digit', day: '2-digit' });
const [month, day, year] = pstString.split('/');
const pstDate = new Date(year, month - 1, day, 12, 0, 0);
document.getElementById('date-input').valueAsDate = pstDate;
            loadEmployeesFromSheet();
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('load-status');
            status.className = 'mb-4 p-3 rounded-lg text-sm';
            if (type === 'loading') {
                status.className += ' bg-blue-100 text-blue-800';
                status.innerHTML = '<span class="loading"></span> ' + message;
            } else if (type === 'success') {
                status.className += ' bg-green-100 text-green-800';
                status.innerHTML = '‚úÖ ' + message;
                setTimeout(() => { status.classList.add('hidden'); }, 3000);
            } else if (type === 'error') {
                status.className += ' bg-red-100 text-red-800';
                status.innerHTML = '‚ùå ' + message;
            }
            status.classList.remove('hidden');
        }
        
   async function loadEmployeesFromSheet() {
    showStatus('Loading employees from Google Sheet...', 'loading');
    
    const proxies = [
        'https://api.allorigins.win/raw?url=',
        'https://corsproxy.io/?',
        'https://api.codetabs.com/v1/proxy?quest='
    ];
    
    const fetchWithTimeout = async (url, timeout = 8000) => {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), timeout);
        try {
            const response = await fetch(url, { signal: controller.signal });
            clearTimeout(id);
            return response;
        } catch (error) {
            clearTimeout(id);
            throw error;
        }
    };
    
    const tryProxy = async (proxy) => {
        const url = proxy + encodeURIComponent(GOOGLE_SHEET_URL) + '&_=' + Date.now();
        const response = await fetchWithTimeout(url);
        if (!response.ok) throw new Error('Bad response');
        const csvText = await response.text();
        if (!csvText || csvText.length < 50) throw new Error('Empty');
        return csvText;
    };
    
    try {
        const csvText = await Promise.any(proxies.map(p => tryProxy(p)));
        parseEmployeeCSV(csvText);
        
        const total = EMPLOYEE_LIST.servers.length + EMPLOYEE_LIST.bussers.length + 
                      EMPLOYEE_LIST.hosts.length + EMPLOYEE_LIST.kitchen.length;
        
        if (total > 0) {
            renderEmployees('hosts');
            renderEmployees('bussers');
            renderEmployees('kitchen');
            renderEmployees('servers');
            showStatus('Loaded ' + total + ' employees from Google Sheet!', 'success');
        } else {
            throw new Error('No employees');
        }
    } catch (error) {
        console.error('All proxies failed:', error);
        showStatus('Could not load from Google Sheet. Using backup list.', 'error');
        loadBackupEmployeeList();
        renderEmployees('hosts');
        renderEmployees('bussers');
        renderEmployees('kitchen');
        renderEmployees('servers');
    }
}
        
        function loadBackupEmployeeList() {
            EMPLOYEE_LIST = {
                servers: ["Thomas Ahlgren", "Nelson Amaya", "Tito Ayon Banuelos", "Brian Brown", "Keoni Carew", "Taco Dorado", "Aalyah Fuentes", "Marisa Givens", "Alicia Gonzalez", "Kayla Martinez", "Bri Oehring", "Manny Osornio-Mejia", "Mike Vu", "Amanda Watson"],
                bussers: ["Emily Ahlgren", "Alex Becerra", "Mariana Cortez-Ortiz", "Thomas Galigher", "Lucas Hurtado", "Aly McClellan", "Manuel Orozco", "Christian Rivera", "Jamie Seablom", "Jocelyn Shumway", "Clairie Thomas"],
                hosts: ["Mariana Cortez-Ortiz", "Lucas Hurtado", "Christian Rivera", "Jamie Seablom", "Jocelyn Shumway"],
                kitchen: ["Santiago Estrada", "Francisco Flores", "Maria Garcia", "Orlando Garduno", "Guadalupe Gomez", "Jose Manzo", "Luis Marin Vejar", "Saul Martinez Cisneros", "Roberto Martinez", "Cynthia Melgoza", "Denia Meza Hernandez", "Jesus Nava", "Fermin Orozco", "Moises Orozco", "Milena Ortega", "Claudia Peralta", "Roberto Ramirez", "Enrique Ramos", "Jose Rivero Lopez", "Juan Rojas Rojas", "Nini Romero"]
            };
        }
        
        function parseEmployeeCSV(csvText) {
            EMPLOYEE_LIST = { servers: [], bussers: [], hosts: [], kitchen: [] };
            const lines = csvText.split('\n');
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                const parts = parseCSVLine(line);
                if (parts.length < 2) continue;
                const name = parts[0].trim();
                const position = parts[1].trim().toLowerCase();
                if (!name || !position) continue;
                if (position.includes('server') || position.includes('bartender')) {
                    if (!EMPLOYEE_LIST.servers.includes(name)) EMPLOYEE_LIST.servers.push(name);
                }
                if (position.includes('host')) {
                    if (!EMPLOYEE_LIST.hosts.includes(name)) EMPLOYEE_LIST.hosts.push(name);
                }
                if (position.includes('bus') || position.includes('expo') || position.includes('food runner')) {
                    if (!EMPLOYEE_LIST.bussers.includes(name)) EMPLOYEE_LIST.bussers.push(name);
                }
                if (position.includes('cook') || position.includes('pantry') || position.includes('prep') || position.includes('dishwasher') || position.includes('kitchen')) {
                    if (!EMPLOYEE_LIST.kitchen.includes(name)) EMPLOYEE_LIST.kitchen.push(name);
                }
            }
            EMPLOYEE_LIST.servers.sort();
            EMPLOYEE_LIST.bussers.sort();
            EMPLOYEE_LIST.hosts.sort();
            EMPLOYEE_LIST.kitchen.sort();
        }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') { inQuotes = !inQuotes; }
                else if (char === ',' && !inQuotes) { result.push(current); current = ''; }
                else { current += char; }
            }
            result.push(current);
            return result;
        }

        function addEmployee(type) {
            if (type === 'hosts' || type === 'kitchen') { employees[type].push({ name: '' }); }
            else { employees[type].push({ name: '', hours: '' }); }
            renderEmployees(type);
        }

        function removeEmployee(type, index) {
            if (employees[type].length > 1) { employees[type].splice(index, 1); renderEmployees(type); }
        }

     function createDropdown(type, index, selectedValue) {
    const list = EMPLOYEE_LIST[type];
    let options = '<option value="">-- Select Employee --</option>';
    
    if (list.length === 0) { 
        options += '<option value="" disabled>No employees loaded</option>'; 
    } else { 
        list.forEach(name => { 
            options += '<option value="' + name + '"' + (name === selectedValue ? ' selected' : '') + '>' + name + '</option>'; 
        }); 
    }
    
    // Add "Other Staff" section with ALL employees
    const allEmployees = [...new Set([
        ...EMPLOYEE_LIST.hosts,
        ...EMPLOYEE_LIST.bussers,
        ...EMPLOYEE_LIST.kitchen,
        ...EMPLOYEE_LIST.servers
    ])].sort();
    
    const otherStaff = allEmployees.filter(name => !list.includes(name));
    
    if (otherStaff.length > 0) {
        options += '<option disabled>‚îÄ‚îÄ Other Staff ‚îÄ‚îÄ</option>';
        otherStaff.forEach(name => {
            options += '<option value="' + name + '"' + (name === selectedValue ? ' selected' : '') + '>' + name + '</option>';
        });
    }
    
    return options;
}

        function renderEmployees(type) {
            const container = document.getElementById(type + '-list');
            if (type === 'hosts' || type === 'kitchen') {
                container.innerHTML = employees[type].map((emp, idx) => '<div class="flex gap-2 mb-2"><select onchange="employees[\'' + type + '\'][' + idx + '].name = this.value" class="flex-1 px-3 sm:px-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base bg-white">' + createDropdown(type, idx, emp.name) + '</select>' + (employees[type].length > 1 ? '<button onclick="removeEmployee(\'' + type + '\', ' + idx + ')" class="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 active:bg-red-300 min-w-[44px]">√ó</button>' : '') + '</div>').join('');
            } else {
                container.innerHTML = employees[type].map((emp, idx) => '<div class="flex gap-2 mb-2"><select onchange="employees[\'' + type + '\'][' + idx + '].name = this.value" class="flex-1 px-3 sm:px-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base bg-white">' + createDropdown(type, idx, emp.name) + '</select><input type="number" step="0.01" value="' + emp.hours + '" onchange="employees[\'' + type + '\'][' + idx + '].hours = this.value" placeholder="Hours" class="w-20 sm:w-24 px-2 sm:px-4 py-2.5 sm:py-2 border border-slate-300 rounded-lg text-base" />' + (employees[type].length > 1 ? '<button onclick="removeEmployee(\'' + type + '\', ' + idx + ')" class="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 active:bg-red-300 min-w-[44px]">√ó</button>' : '') + '</div>').join('');
            }
        }

        function calculateTips() {
            const sales = parseFloat(document.getElementById('total-sales').value) || 0;
            const ccTips = parseFloat(document.getElementById('cc-tips').value) || 0;
            const cashTips = parseFloat(document.getElementById('cash-tips').value) || 0;
            const hostTips = parseFloat(document.getElementById('host-tips').value) || 0;
            const totalTips = ccTips + cashTips;
            const busserPool = sales * 0.02;
            const kitchenPool = sales * 0.01;
            const fohPool = totalTips - hostTips - busserPool - kitchenPool;
            const activeHosts = employees.hosts.filter(e => e.name);
            const activeBussers = employees.bussers.filter(e => e.name && e.hours);
            const activeKitchen = employees.kitchen.filter(e => e.name);
            const activeServers = employees.servers.filter(e => e.name && e.hours);
            const tipPerHost = activeHosts.length > 0 ? hostTips / activeHosts.length : 0;
            const tipPerKitchen = activeKitchen.length > 0 ? kitchenPool / activeKitchen.length : 0;
            const totalBusserHours = activeBussers.reduce((sum, b) => sum + parseFloat(b.hours), 0);
            const busserTipPerHour = totalBusserHours > 0 ? busserPool / totalBusserHours : 0;
            const totalServerHours = activeServers.reduce((sum, s) => sum + parseFloat(s.hours), 0);
            const serverTipPerHour = totalServerHours > 0 ? fohPool / totalServerHours : 0;
            const results = [
                ...activeHosts.map(h => ({ name: h.name, role: 'Host', hours: 0, tips: tipPerHost })),
                ...activeBussers.map(b => ({ name: b.name, role: 'Busser/Expo', hours: parseFloat(b.hours), tips: parseFloat(b.hours) * busserTipPerHour })),
                ...activeKitchen.map(k => ({ name: k.name, role: 'Kitchen (BOH)', hours: 0, tips: tipPerKitchen })),
                ...activeServers.map(s => ({ name: s.name, role: 'Server/Bartender', hours: parseFloat(s.hours), tips: parseFloat(s.hours) * serverTipPerHour }))
            ];
            calculatedResults = results;
            dailyTotals = { totalSales: sales, ccTips: ccTips, cashTips: cashTips, totalTips: totalTips, hostTips: hostTips, busserPool: busserPool, kitchenPool: kitchenPool, fohPool: fohPool };
            displayResults(results, hostTips, busserPool, kitchenPool, fohPool, totalTips);
        }

        function displayResults(results, hostTips, busserPool, kitchenPool, fohPool, totalTips) {
            const container = document.getElementById('results');
            const totalDistributed = results.reduce((sum, r) => sum + r.tips, 0);

            const employeeRows = results.map(emp =>
                '<div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">' +
                '<div><p class="font-semibold text-slate-800">' + emp.name + '</p>' +
                '<p class="text-sm text-slate-600">' + emp.role + (emp.hours > 0 ? ' ‚Ä¢ ' + emp.hours + ' hours' : '') + '</p></div>' +
                '<p class="text-xl font-bold text-slate-800">$' + emp.tips.toFixed(2) + '</p></div>'
            ).join('');

            const shiftLeadOptions = getAllManagersDropdown();

            container.innerHTML =
                '<h2 class="text-xl sm:text-2xl font-bold text-slate-800 mb-4">üìä Tip Distribution Results</h2>' +
                '<div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-6 p-4 bg-slate-50 rounded-lg">' +
                    '<div><p class="text-xs sm:text-sm text-slate-600">Host Tips</p><p class="text-lg sm:text-2xl font-bold text-purple-600">$' + hostTips.toFixed(2) + '</p></div>' +
                    '<div><p class="text-xs sm:text-sm text-slate-600">Busser Pool (2%)</p><p class="text-lg sm:text-2xl font-bold text-blue-600">$' + busserPool.toFixed(2) + '</p></div>' +
                    '<div><p class="text-xs sm:text-sm text-slate-600">Kitchen Pool (1%)</p><p class="text-lg sm:text-2xl font-bold text-orange-600">$' + kitchenPool.toFixed(2) + '</p></div>' +
                    '<div><p class="text-xs sm:text-sm text-slate-600">FOH Pool</p><p class="text-lg sm:text-2xl font-bold text-green-600">$' + fohPool.toFixed(2) + '</p></div>' +
                '</div>' +
                '<div class="space-y-2 mb-6">' + employeeRows + '</div>' +
                '<div class="flex justify-between items-center p-4 bg-slate-800 text-white rounded-lg mb-4">' +
                    '<p class="text-base sm:text-lg font-semibold">Total Tips Distributed</p>' +
                    '<p class="text-xl sm:text-2xl font-bold">$' + totalDistributed.toFixed(2) + '</p>' +
                '</div>' +
                '<div class="mb-4">' +
                    '<label class="block text-sm font-semibold text-slate-700 mb-2">Shift Lead Sign-Off</label>' +
                    '<select id="shift-lead" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-base bg-white">' +
                        '<option value="">-- Select Shift Lead --</option>' +
                        shiftLeadOptions +
                    '</select>' +
                '</div>' +
                '<button id="send-btn" onclick="sendToGoogleSheets()" class="w-full bg-green-600 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg hover:bg-green-700 active:bg-green-800">üìä Send to Google Sheets</button>' +
                '<p id="send-status" class="text-center mt-3 text-sm hidden"></p>';

            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function getAllManagersDropdown() {
            const allEmployees = [...new Set([
                ...EMPLOYEE_LIST.hosts,
                ...EMPLOYEE_LIST.bussers,
                ...EMPLOYEE_LIST.kitchen,
                ...EMPLOYEE_LIST.servers
            ])].sort();

            return allEmployees.map(name => '<option value="' + name + '">' + name + '</option>').join('');
        }
        async function sendToGoogleSheets() {
            const btn = document.getElementById('send-btn');
            const status = document.getElementById('send-status');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Sending...';
            status.className = 'text-center mt-3 text-sm text-blue-600';
            status.textContent = 'Sending data to Google Sheets...';
            status.classList.remove('hidden');
            const dateInput = document.getElementById('date-input').value;
            const shiftLead = document.getElementById('shift-lead').value;
            const payload = {
                date: dateInput,
                shiftLead: shiftLead,
                totalSales: dailyTotals.totalSales,
                ccTips: dailyTotals.ccTips,
                cashTips: dailyTotals.cashTips,
                totalTips: dailyTotals.totalTips,
                employees: calculatedResults.map(emp => ({ name: emp.name, role: emp.role, hours: emp.hours, tips: Math.round(emp.tips * 100) / 100 }))
            };
            try {
                await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                btn.innerHTML = '‚úÖ Sent Successfully!';
                btn.className = 'w-full bg-green-700 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg';
                status.className = 'text-center mt-3 text-sm text-green-600';
                status.textContent = '‚úÖ Data sent to Google Sheets! Check your Weekly Tipout sheet.';
                setTimeout(() => { btn.innerHTML = 'üìä Send to Google Sheets'; btn.className = 'w-full bg-green-600 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg hover:bg-green-700 active:bg-green-800'; btn.disabled = false; }, 3000);
            } catch (error) {
                console.error('Error sending to Google Sheets:', error);
                btn.innerHTML = '‚ùå Failed - Try Again';
                btn.className = 'w-full bg-red-600 text-white py-3 sm:py-4 rounded-lg font-semibold text-base sm:text-lg hover:bg-red-700';
                btn.disabled = false;
                status.className = 'text-center mt-3 text-sm text-red-600';
                status.textContent = '‚ùå Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
